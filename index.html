<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estado de Pacientes</title>
</head>
<body>
    <h1>Estado de Pacientes</h1>

    <!-- Formulario para agregar paciente -->
    <form id="form-paciente">
        <input type="text" id="sede" placeholder="Sede" required>
        <input type="text" id="apellido" placeholder="Apellido" required>
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="estudio" placeholder="Estudio" required>
        <button type="submit">Agregar Paciente</button>
    </form>

    <!-- Lista de pacientes -->
    <h2>Lista de Pacientes</h2>
    <ul id="pacientes"></ul>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA1LYlm8HRhW1MPCxsgrQtiFO5rvS0v2_s",
            authDomain: "app-ecografia.firebaseapp.com",
            databaseURL: "https://app-ecografia-default-rtdb.firebaseio.com",
            projectId: "app-ecografia",
            storageBucket: "app-ecografia.firebasestorage.app",
            messagingSenderId: "241799347066",
            appId: "1:241799347066:web:b10b3c963ec9c88f1d34c3",
            measurementId: "G-ZB2XS0DFC8"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Referencias a elementos del formulario y la lista
        const sedeInput = document.getElementById("sede");
        const apellidoInput = document.getElementById("apellido");
        const nombreInput = document.getElementById("nombre");
        const estudioInput = document.getElementById("estudio");
        const pacientesList = document.getElementById("pacientes");
        const form = document.getElementById("form-paciente");

        // Función para mostrar la lista de pacientes en tiempo real
        function mostrarPacientes() {
            const pacientesRef = db.ref('pacientes');
            pacientesRef.on('value', function (snapshot) {
                pacientesList.innerHTML = ''; // Limpiar la lista actual

                snapshot.forEach(function (childSnapshot) {
                    const paciente = childSnapshot.val();
                    const li = document.createElement('li');
                    li.textContent = `${paciente.apellido}, ${paciente.nombre} - ${paciente.estudio} (${paciente.sede}) - Estado: ${paciente.estado}`;
                    
                    // Botón para actualizar estado
                    const button = document.createElement('button');
                    button.textContent = 'Cambiar Estado';
                    button.onclick = function() {
                        actualizarEstado(childSnapshot.key, paciente.estado);
                    };

                    li.appendChild(button);
                    pacientesList.appendChild(li);
                });
            });
        }

        // Función para actualizar el estado de un paciente
        function actualizarEstado(id, estadoActual) {
            const pacientesRef = db.ref('pacientes/' + id);
            const nuevoEstado = estadoActual === 'Programado' ? 'En espera' :
                                estadoActual === 'En espera' ? 'En atención' : 'Atendido';

            // Actualizar el estado en Firebase
            pacientesRef.update({ estado: nuevoEstado });
        }

        // Agregar un paciente a Firebase
        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const paciente = {
                sede: sedeInput.value,
                apellido: apellidoInput.value,
                nombre: nombreInput.value,
                estudio: estudioInput.value,
                estado: 'Programado' // Estado inicial
            };

            // Guardar en Firebase
            const pacientesRef = db.ref('pacientes');
            pacientesRef.push(paciente);

            // Limpiar el formulario
            sedeInput.value = '';
            apellidoInput.value = '';
            nombreInput.value = '';
            estudioInput.value = '';
        });

        // Llamar a la función para mostrar los pacientes cuando se cargue la página
        mostrarPacientes();
    </script>
</body>
</html>
