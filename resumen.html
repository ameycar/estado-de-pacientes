<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Resumen de Pacientes</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center; }
    h1, h2 { margin: 20px; }
    .estado { margin: 10px; padding: 10px; border-radius: 5px; color: white; }
    .programado { background: #007bff; }
    .espera { background: #dc3545; }
    .atencion { background: #fd7e14; }
    .atendido { background: #28a745; }
  </style>
</head>
<body>
  <h1>Resumen de Pacientes</h1>
  <h2>Pacientes por Estado</h2>

  <div id="programado" class="estado programado">
    <h3>Programados</h3>
    <p id="count-programado">0</p>
  </div>

  <div id="espera" class="estado espera">
    <h3>En Espera</h3>
    <p id="count-espera">0</p>
  </div>

  <div id="atencion" class="estado atencion">
    <h3>En Atención</h3>
    <p id="count-atencion">0</p>
  </div>

  <div id="atendido" class="estado atendido">
    <h3>Atendidos</h3>
    <p id="count-atendido">0</p>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
    import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyA1LYlm8HRhW1MPCxsgrQtiFO5rvS0v2_s",
      authDomain: "app-ecografia.firebaseapp.com",
      databaseURL: "https://app-ecografia-default-rtdb.firebaseio.com",
      projectId: "app-ecografia",
      storageBucket: "app-ecografia.firebasestorage.app",
      messagingSenderId: "241799347066",
      appId: "1:241799347066:web:b10b3c963ec9c88f1d34c3",
      measurementId: "G-ZB2XS0DFC8"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    const stateCount = {
      Programado: 0,
      'En espera': 0,
      'En atención': 0,
      Atendido: 0
    };

    const countElements = {
      Programado: document.getElementById('count-programado'),
      'En espera': document.getElementById('count-espera'),
      'En atención': document.getElementById('count-atencion'),
      Atendido: document.getElementById('count-atendido')
    };

    onValue(ref(db, 'pacientes'), snapshot => {
      snapshot.forEach(child => {
        const p = child.val();
        stateCount[p.estado]++;
      });

      // Actualiza los contadores en el DOM
      for (const state in stateCount) {
        countElements[state].textContent = stateCount[state];
      }
    });
  </script>
</body>
</html>
